# Controla la ejecuciÃ³n del Workflow solo en determinados eventos
on:
    # Acciona el Workflow solo en eventos PUSH y PULL REQUESTS
    push:
        branches: [ "master" ]
    pull_request:
        branches: [ "master" ]

    # Permite ejecutar el Workflow manualmente
    workflow_dispatch:


# Flujo de todas las acciones a ejecutar
jobs:

    # El Workflow de despacho de notificaciones (Discord)
    discord_dispatcher:
        name: Notification dispatcher
        runs-on: ubuntu-latest

        # Este paso solo se ejecuta si el evento es un commit (Push)
        # y corresponde a la rama maestra del repositorio.
        if: ${{ github.event_name == 'push' && github.ref == 'refs/heads/master' }}
        steps:
            - name: Discord Webhook Notify
              uses: rjstone/discord-webhook-notify@v2.2.1

              with:
                  webhookUrl: ${{ secrets.DISCORD_WEBHOOK }}
                  username: LoveLive! UNOFFICIAL PROJECT
                  avatarUrl: https://raw.githubusercontent.com/CharlieFuu69/lovelive-unofficial-project/refs/heads/master/img/window_icon.png
                  text: "> **Tags:** @Commits"
                  
                  severity: info
                  color: '#CCFF00'
                  title: "Commit notification (Public)"
                  description: "> ${{ github.event.head_commit.message }}"
                  footer: "[Target]: CharlieFuu69/lovelive-unofficial-project"


    # El Workflow de despacho de notificaciones (Telegram)
    telegram_dispatcher:
        name: Telegram dispatcher
        runs-on: ubuntu-latest

        # Este paso ejecuta el despacho de notificaciones
        steps:
            # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
            - uses: actions/checkout@v4
            - name: Github Telegram Notifier
              uses: EverythingSuckz/github-telegram-notify@main
              with:
                  bot_token: '${{ secrets.TELEGRAM_NOTIFIER_TOKEN }}'
                  chat_id: '${{ secrets.CHAT_ID }}'
